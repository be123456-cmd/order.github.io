<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simple Order — Popup Customizer</title>
  <style>
    :root{
      --text:#e8eefc;
      --muted:#98a6c7;
      --line:rgba(255,255,255,.12);
      --accent:#43d3c3;
      --accent2:#ffb84a;
      --danger:#ff5c7a;
      --shadow: 0 18px 60px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", "Noto Sans";
      background: radial-gradient(1200px 600px at 20% 0%, rgba(67,211,195,.22), transparent 50%),
                  radial-gradient(900px 500px at 90% 15%, rgba(255,184,74,.18), transparent 55%),
                  linear-gradient(180deg, #070c16, #060913 35%, #050711);
      color:var(--text);
      min-height:100vh;
      padding:28px 16px;
    }
    .wrap{max-width:1100px;margin:0 auto;}
    .hero{
      background: linear-gradient(90deg, rgba(67,211,195,.25), rgba(255,184,74,.18));
      border: 1px solid var(--line);
      border-radius: calc(var(--radius) + 6px);
      padding:18px 18px;
      box-shadow: var(--shadow);
      display:flex; align-items:center; justify-content:space-between; gap:14px;
    }
    .hero h1{margin:0;font-size:20px;letter-spacing:.2px}
    .hero p{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.35}
    .hero .badge{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;}
    .pill{
      background: rgba(15,27,51,.75);
      border:1px solid var(--line);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      display:inline-flex; align-items:center; gap:8px;
      white-space:nowrap;
    }
    .dot{width:8px;height:8px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 4px rgba(67,211,195,.15)}
    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: 1.35fr .85fr;
      gap:16px;
    }
    @media (max-width: 920px){ .grid{grid-template-columns:1fr;} }

    .panel{
      background: rgba(15,27,51,.75);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panelHead{
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px dashed rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
      gap:12px;
    }
    .panelHead h2{
      margin:0;
      font-size:14px;
      letter-spacing:.35px;
      text-transform:uppercase;
      color:#cfe0ff;
    }
    .panelHead .small{font-size:12px;color:var(--muted)}
    .menu{padding:8px 10px 14px;}
    .category{margin-top:10px;padding:0 6px;}
    .categoryTitle{
      margin:14px 0 8px;
      font-size:13px;color:#d9e6ff;
      display:flex;align-items:center;gap:10px;
    }
    .categoryTitle span{color:var(--muted);font-size:12px;font-weight:500}
    .hr{flex:1;height:1px;background: rgba(255,255,255,.12)}

    .item{
      background: rgba(11,24,48,.55);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:12px;
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:center;
      margin-bottom:10px;
    }
    .item h3{margin:0;font-size:14px;font-weight:750;letter-spacing:.2px;}
    .meta{margin-top:4px;display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:12px;}
    .price{color:var(--accent2);font-weight:900;}
    .time{color:#b9c7e8;}
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(15,27,51,.85);
      color: var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:850;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .btn:hover{background: rgba(25,45,82,.7); border-color: rgba(255,255,255,.22);}
    .btn:active{transform: translateY(1px);}
    .btn.primary{
      background: linear-gradient(90deg, rgba(67,211,195,.95), rgba(67,211,195,.75));
      border:1px solid rgba(67,211,195,.55);
      color:#06221f;
    }
    .btn.danger{
      border-color: rgba(255,92,122,.35);
    }
    .btn.danger:hover{background: rgba(255,92,122,.14);}
    .btn.icon{width:36px;height:34px; display:grid; place-items:center; padding:0;}
    .qty{min-width:22px;text-align:center;color:#dfe9ff;font-weight:900;font-size:13px;}

    /* Cart */
    .cart{padding:12px 14px 14px;}
    .summaryBox{
      background: rgba(255,184,74,.16);
      border: 1px solid rgba(255,184,74,.28);
      border-radius: 16px;
      padding:12px;
      margin-bottom:12px;
      display:grid;
      gap:6px;
    }
    .summaryRow{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:#f7f0df;}
    .summaryRow strong{font-size:16px;color:#fff;}
    .summaryRow .muted{color: rgba(255,255,255,.7); font-size:12px;}
    .cartList{margin:0;padding:0;list-style:none;display:grid;gap:10px;}
    .cartItem{
      background: rgba(11,24,48,.55);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:10px;
      display:grid;
      grid-template-columns: 1fr auto;
      gap:8px;
      align-items:center;
    }
    .cartItem .name{font-size:13px;font-weight:850;}
    .cartItem .sub{
      margin-top:6px;
      color:var(--muted);
      font-size:12px;
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .chip{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.78);
      background: rgba(15,27,51,.6);
      white-space:nowrap;
    }
    .cartItem .right{display:flex;align-items:center;gap:8px;}
    .actions{display:grid;gap:10px;margin-top:12px;}
    .empty{padding:14px 6px 6px;color:var(--muted);font-size:13px;line-height:1.4;}

    /* Modal base */
    .backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .modal{
      max-width:640px;
      width:100%;
      background: rgba(15,27,51,.98);
      border:1px solid rgba(255,255,255,.16);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHead{
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background: linear-gradient(90deg, rgba(67,211,195,.16), rgba(255,184,74,.12));
    }
    .modalHead h3{margin:0;font-size:14px;letter-spacing:.3px}
    .modalBody{padding:14px 16px;}
    .modalFoot{
      padding:12px 16px;
      border-top:1px solid rgba(255,255,255,.10);
      display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;
    }
    .finalList{
      background: rgba(11,24,48,.55);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      color:#dbe7ff;
      white-space:pre-wrap;
      line-height:1.45;
    }

    /* Customizer modal content */
    .subTitle{
      color: rgba(255,255,255,.75);
      font-size:12px;
      margin-top:6px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .optSection{
      margin-top:12px;
      background: rgba(11,24,48,.45);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:12px;
    }
    .optHeader{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:10px;
    }
    .optHeader .title{
      font-size:12px;
      letter-spacing:.35px;
      text-transform:uppercase;
      color:#d9e6ff;
      font-weight:900;
    }
    .optHeader .hint{
      font-size:11px;
      color: rgba(255,255,255,.62);
    }
    .optGrid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
    }
    @media (max-width:520px){ .optGrid{grid-template-columns:1fr;} }
    .optRow{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(15,27,51,.35);
    }
    .optRow label{cursor:pointer; width:100%;}
    .optName{font-size:12px;color:#eaf1ff;font-weight:900}
    .optSub{margin-top:3px;font-size:11px;color:rgba(255,255,255,.65);display:flex;gap:10px;flex-wrap:wrap}
    .optP{color:var(--accent2);font-weight:900}
    input[type="radio"], input[type="checkbox"]{
      margin-top:2px;
      accent-color: var(--accent);
      transform: scale(1.06);
    }

    .qtyBar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-top:12px;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(11,24,48,.45);
    }
    .qtyBar .left{display:grid; gap:4px;}
    .qtyBar .left .k{font-size:12px;color:rgba(255,255,255,.75)}
    .qtyBar .left .v{font-size:14px;font-weight:950;color:#fff}
    .qtyBar .right{display:flex; align-items:center; gap:10px;}
    .miniBtn{
      width:38px;height:36px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(15,27,51,.85);
      color: var(--text);
      cursor:pointer;
      font-weight:950;
    }
    .miniBtn:hover{background: rgba(25,45,82,.7); border-color: rgba(255,255,255,.22);}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <div>
        <h1>What would you like to order?</h1>
        <p>Tap <b>Add</b> to customize (no onion, extra cheese, sauce choice, etc.). Options appear in cart + final summary.</p>
      </div>
      <div class="badge">
        <div class="pill"><span class="dot"></span> Popup customization</div>
        <div class="pill">GitHub Pages ready</div>
      </div>
    </div>

    <div class="grid">
      <!-- MENU -->
      <section class="panel" aria-label="Menu">
        <div class="panelHead">
          <h2>Menu</h2>
          <div class="small">Prices in $ • Prep time in minutes</div>
        </div>
        <div class="menu" id="menu"></div>
      </section>

      <!-- CART -->
      <aside class="panel" aria-label="Cart">
        <div class="panelHead">
          <h2>Selected Items</h2>
          <div class="small" id="cartCount">0 items</div>
        </div>

        <div class="cart">
          <div class="summaryBox">
            <div class="summaryRow">
              <span>Total</span>
              <strong id="totalPrice">$0.00</strong>
            </div>
            <div class="summaryRow">
              <span class="muted">Estimated prep time</span>
              <span id="totalTime" class="muted">0 min</span>
            </div>
          </div>

          <ul class="cartList" id="cartList"></ul>

          <div class="empty" id="emptyState">
            Your cart is empty.<br/>
            Add items from the menu.
          </div>

          <div class="actions">
            <button class="btn primary" id="placeOrderBtn">Place Order</button>
            <button class="btn danger" id="clearBtn">Clear Cart</button>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- CUSTOMIZER MODAL -->
  <div class="backdrop" id="customBackdrop" role="dialog" aria-modal="true" aria-labelledby="customTitle">
    <div class="modal">
      <div class="modalHead">
        <div>
          <h3 id="customTitle">Customize</h3>
          <div class="subTitle" id="customSub"></div>
        </div>
        <button class="btn icon" id="customCloseBtn" aria-label="Close">✕</button>
      </div>

      <div class="modalBody">
        <div id="customOptions"></div>

        <div class="qtyBar">
          <div class="left">
            <div class="k">This customized item</div>
            <div class="v" id="customUnitLine">$0.00 each • ~0 min</div>
          </div>
          <div class="right">
            <button class="miniBtn" id="customMinus" aria-label="Decrease">−</button>
            <div class="qty" id="customQty">1</div>
            <button class="miniBtn" id="customPlus" aria-label="Increase">+</button>
          </div>
        </div>
      </div>

      <div class="modalFoot">
        <button class="btn danger" id="customResetBtn">Reset</button>
        <button class="btn primary" id="customConfirmBtn">Add to Cart</button>
      </div>
    </div>
  </div>

  <!-- ORDER SUMMARY MODAL -->
  <div class="backdrop" id="summaryBackdrop" role="dialog" aria-modal="true" aria-labelledby="summaryTitle">
    <div class="modal">
      <div class="modalHead">
        <h3 id="summaryTitle">Order submitted!</h3>
        <button class="btn icon" id="summaryCloseBtn" aria-label="Close">✕</button>
      </div>
      <div class="modalBody">
        <div class="finalList" id="finalList"></div>
      </div>
      <div class="modalFoot">
        <button class="btn" id="copyBtn">Copy Summary</button>
        <button class="btn primary" id="newOrderBtn">New Order</button>
      </div>
    </div>
  </div>

  <script>
    // ====== MENU DATA (Western) + customization ======
    // option schema:
    // - type: "radio" or "checkbox"
    // - key, label
    // - choices: { id, label, priceDelta, timeDelta }
    const MENU = [
      { category:"Mains", items:[
        { id:"ribeye", name:"Ribeye Steak (10oz)", price:28.00, time:18, note:"with herb butter",
          options:[
            { type:"radio", key:"doneness", label:"Doneness", default:"med-rare",
              choices:[
                {id:"rare", label:"Rare", priceDelta:0, timeDelta:0},
                {id:"med-rare", label:"Medium Rare", priceDelta:0, timeDelta:1},
                {id:"medium", label:"Medium", priceDelta:0, timeDelta:2},
                {id:"well", label:"Well Done", priceDelta:0, timeDelta:4},
              ]
            },
            { type:"checkbox", key:"addons", label:"Add-ons",
              choices:[
                {id:"pepper", label:"Peppercorn Sauce", priceDelta:1.50, timeDelta:0},
                {id:"mushroom", label:"Sautéed Mushrooms", priceDelta:2.00, timeDelta:1},
                {id:"butter", label:"Extra Herb Butter", priceDelta:0.75, timeDelta:0},
              ]
            }
          ]
        },
        { id:"salmon", name:"Pan-Seared Salmon", price:22.00, time:14, note:"lemon dill sauce",
          options:[
            { type:"radio", key:"sauce", label:"Sauce", default:"lemon_dill",
              choices:[
                {id:"lemon_dill", label:"Lemon Dill (default)", priceDelta:0, timeDelta:0},
                {id:"teriyaki", label:"Teriyaki Glaze", priceDelta:0.50, timeDelta:0},
                {id:"garlic_butter", label:"Garlic Butter", priceDelta:0.75, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"prefs", label:"Preferences",
              choices:[
                {id:"no_lemon", label:"No Lemon", priceDelta:0, timeDelta:0},
                {id:"extra_sauce", label:"Extra Sauce", priceDelta:0.50, timeDelta:0},
                {id:"less_salt", label:"Less Salt", priceDelta:0, timeDelta:0},
              ]
            }
          ]
        },
        { id:"alfredo", name:"Chicken Alfredo Pasta", price:18.00, time:12, note:"parmesan cream",
          options:[
            { type:"radio", key:"pasta", label:"Pasta Type", default:"fettuccine",
              choices:[
                {id:"fettuccine", label:"Fettuccine (default)", priceDelta:0, timeDelta:0},
                {id:"penne", label:"Penne", priceDelta:0, timeDelta:0},
                {id:"spaghetti", label:"Spaghetti", priceDelta:0, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"addons", label:"Add-ons",
              choices:[
                {id:"extra_cheese", label:"Extra Parmesan", priceDelta:1.00, timeDelta:0},
                {id:"mushroom", label:"Mushrooms", priceDelta:1.50, timeDelta:1},
                {id:"spicy", label:"Make it Spicy", priceDelta:0, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"remove", label:"Remove",
              choices:[
                {id:"no_garlic", label:"No Garlic", priceDelta:0, timeDelta:0},
                {id:"no_onion", label:"No Onion", priceDelta:0, timeDelta:0},
              ]
            }
          ]
        },
        { id:"burger", name:"Classic Cheeseburger", price:16.00, time:10, note:"pick your toppings",
          options:[
            { type:"radio", key:"bun", label:"Bun", default:"brioche",
              choices:[
                {id:"brioche", label:"Brioche (default)", priceDelta:0, timeDelta:0},
                {id:"sesame", label:"Sesame", priceDelta:0, timeDelta:0},
                {id:"lettuce", label:"Lettuce Wrap", priceDelta:0, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"remove", label:"Remove",
              choices:[
                {id:"no_onion", label:"No Onion", priceDelta:0, timeDelta:0},
                {id:"no_pickle", label:"No Pickles", priceDelta:0, timeDelta:0},
                {id:"no_tomato", label:"No Tomato", priceDelta:0, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"addons", label:"Add-ons",
              choices:[
                {id:"extra_cheese", label:"Extra Cheese", priceDelta:1.25, timeDelta:0},
                {id:"bacon", label:"Add Bacon", priceDelta:2.00, timeDelta:1},
                {id:"jalapeno", label:"Jalapeños", priceDelta:0.75, timeDelta:0},
              ]
            }
          ]
        },
      ]},
      { category:"Sides", items:[
        { id:"fries", name:"Truffle Fries", price:7.00, time:6, note:"parmesan + aioli",
          options:[
            { type:"radio", key:"salt", label:"Seasoning", default:"regular",
              choices:[
                {id:"regular", label:"Regular Salt", priceDelta:0, timeDelta:0},
                {id:"light", label:"Light Salt", priceDelta:0, timeDelta:0},
                {id:"none", label:"No Salt", priceDelta:0, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"dips", label:"Dips",
              choices:[
                {id:"aioli", label:"Extra Aioli", priceDelta:0.75, timeDelta:0},
                {id:"ketchup", label:"Ketchup", priceDelta:0, timeDelta:0},
                {id:"bbq", label:"BBQ Sauce", priceDelta:0.50, timeDelta:0},
              ]
            }
          ]
        },
        { id:"salad", name:"Garden Salad", price:6.00, time:4, note:"vinaigrette",
          options:[
            { type:"radio", key:"dressing", label:"Dressing", default:"vinaigrette",
              choices:[
                {id:"vinaigrette", label:"Vinaigrette (default)", priceDelta:0, timeDelta:0},
                {id:"ranch", label:"Ranch", priceDelta:0, timeDelta:0},
                {id:"caesar", label:"Caesar", priceDelta:0, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"remove", label:"Remove",
              choices:[
                {id:"no_onion", label:"No Onion", priceDelta:0, timeDelta:0},
                {id:"no_croutons", label:"No Croutons", priceDelta:0, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"addons", label:"Add-ons",
              choices:[
                {id:"avocado", label:"Add Avocado", priceDelta:2.00, timeDelta:0},
                {id:"chicken", label:"Add Chicken", priceDelta:3.50, timeDelta:2},
              ]
            }
          ]
        },
        { id:"mash", name:"Garlic Mashed Potatoes", price:6.50, time:7, note:"buttery",
          options:[
            { type:"radio", key:"texture", label:"Texture", default:"smooth",
              choices:[
                {id:"smooth", label:"Smooth (default)", priceDelta:0, timeDelta:0},
                {id:"chunky", label:"Chunky", priceDelta:0, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"addons", label:"Add-ons",
              choices:[
                {id:"gravy", label:"Add Gravy", priceDelta:1.00, timeDelta:0},
                {id:"butter", label:"Extra Butter", priceDelta:0.50, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"remove", label:"Remove",
              choices:[
                {id:"no_garlic", label:"No Garlic", priceDelta:0, timeDelta:0},
              ]
            }
          ]
        },
      ]},
      { category:"Drinks", items:[
        { id:"cola", name:"Sparkling Cola", price:3.50, time:0, note:"chilled",
          options:[
            { type:"radio", key:"ice", label:"Ice Level", default:"regular",
              choices:[
                {id:"regular", label:"Regular Ice", priceDelta:0, timeDelta:0},
                {id:"less", label:"Less Ice", priceDelta:0, timeDelta:0},
                {id:"none", label:"No Ice", priceDelta:0, timeDelta:0},
              ]
            }
          ]
        },
        { id:"lemonade", name:"Fresh Lemonade", price:4.50, time:2, note:"house-made",
          options:[
            { type:"radio", key:"sweet", label:"Sweetness", default:"normal",
              choices:[
                {id:"normal", label:"Normal", priceDelta:0, timeDelta:0},
                {id:"less", label:"Less Sweet", priceDelta:0, timeDelta:0},
                {id:"zero", label:"No Sugar", priceDelta:0, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"addons", label:"Add-ons",
              choices:[
                {id:"mint", label:"Add Mint", priceDelta:0.50, timeDelta:0},
                {id:"extra_lemon", label:"Extra Lemon", priceDelta:0.25, timeDelta:0},
              ]
            }
          ]
        },
        { id:"latte", name:"Iced Latte", price:5.50, time:3, note:"espresso + milk",
          options:[
            { type:"radio", key:"milk", label:"Milk", default:"whole",
              choices:[
                {id:"whole", label:"Whole Milk (default)", priceDelta:0, timeDelta:0},
                {id:"oat", label:"Oat Milk", priceDelta:0.75, timeDelta:0},
                {id:"almond", label:"Almond Milk", priceDelta:0.75, timeDelta:0},
              ]
            },
            { type:"radio", key:"ice", label:"Ice Level", default:"regular",
              choices:[
                {id:"regular", label:"Regular Ice", priceDelta:0, timeDelta:0},
                {id:"less", label:"Less Ice", priceDelta:0, timeDelta:0},
                {id:"none", label:"No Ice", priceDelta:0, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"addons", label:"Add-ons",
              choices:[
                {id:"vanilla", label:"Vanilla Syrup", priceDelta:0.60, timeDelta:0},
                {id:"shot", label:"Extra Espresso Shot", priceDelta:1.20, timeDelta:1},
              ]
            }
          ]
        },
      ]},
      { category:"Desserts", items:[
        { id:"cheesecake", name:"New York Cheesecake", price:8.00, time:0, note:"berry drizzle",
          options:[
            { type:"radio", key:"topping", label:"Topping", default:"berry",
              choices:[
                {id:"berry", label:"Berry Drizzle (default)", priceDelta:0, timeDelta:0},
                {id:"caramel", label:"Salted Caramel", priceDelta:0.50, timeDelta:0},
                {id:"choco", label:"Chocolate Sauce", priceDelta:0.50, timeDelta:0},
              ]
            }
          ]
        },
        { id:"brownie", name:"Warm Chocolate Brownie", price:7.50, time:3, note:"with vanilla scoop",
          options:[
            { type:"radio", key:"icecream", label:"Ice Cream", default:"vanilla",
              choices:[
                {id:"vanilla", label:"Vanilla (default)", priceDelta:0, timeDelta:0},
                {id:"choco", label:"Chocolate", priceDelta:0, timeDelta:0},
                {id:"strawberry", label:"Strawberry", priceDelta:0, timeDelta:0},
              ]
            },
            { type:"checkbox", key:"addons", label:"Add-ons",
              choices:[
                {id:"nuts", label:"Add Nuts", priceDelta:0.75, timeDelta:0},
                {id:"extra_sauce", label:"Extra Chocolate Sauce", priceDelta:0.50, timeDelta:0},
              ]
            }
          ]
        },
        { id:"tiramisu", name:"Tiramisu", price:8.50, time:0, note:"classic Italian",
          options:[
            { type:"checkbox", key:"prefs", label:"Preferences",
              choices:[
                {id:"less_cocoa", label:"Less Cocoa", priceDelta:0, timeDelta:0},
                {id:"extra_cocoa", label:"Extra Cocoa", priceDelta:0, timeDelta:0},
              ]
            }
          ]
        },
      ]},
    ];

    // ====== STATE ======
    // Cart key includes customization; different options = different cart lines
    const cart = new Map(); // cartKey -> { itemId, qty, optionsState }
    const itemById = Object.fromEntries(MENU.flatMap(c => c.items.map(i => [i.id, i])));

    // currently customizing
    let currentItemId = null;
    let currentOpts = null;   // object
    let currentQty = 1;

    // ====== HELPERS ======
    const money = (n) => `$${n.toFixed(2)}`;
    const clone = (o) => JSON.parse(JSON.stringify(o));

    function normalizedOpts(opts){
      const o = clone(opts || {});
      for (const k of Object.keys(o)){
        if (Array.isArray(o[k])) o[k].sort();
      }
      return o;
    }
    function makeCartKey(itemId, opts){
      return `${itemId}::${JSON.stringify(normalizedOpts(opts))}`;
    }

    function optionsPriceDelta(item, opts){
      let d = 0;
      (item.options || []).forEach(opt=>{
        const v = opts?.[opt.key];
        if (opt.type === "radio" && v){
          const c = opt.choices.find(x=>x.id===v);
          if (c) d += (c.priceDelta || 0);
        }
        if (opt.type === "checkbox" && Array.isArray(v)){
          v.forEach(id=>{
            const c = opt.choices.find(x=>x.id===id);
            if (c) d += (c.priceDelta || 0);
          });
        }
      });
      return d;
    }
    function optionsTimeDelta(item, opts){
      let d = 0;
      (item.options || []).forEach(opt=>{
        const v = opts?.[opt.key];
        if (opt.type === "radio" && v){
          const c = opt.choices.find(x=>x.id===v);
          if (c) d += (c.timeDelta || 0);
        }
        if (opt.type === "checkbox" && Array.isArray(v)){
          v.forEach(id=>{
            const c = opt.choices.find(x=>x.id===id);
            if (c) d += (c.timeDelta || 0);
          });
        }
      });
      return d;
    }

    function optionsToLines(item, opts){
      const lines = [];
      (item.options || []).forEach(opt=>{
        const v = opts?.[opt.key];
        if (opt.type === "radio" && v){
          const c = opt.choices.find(x=>x.id===v);
          if (c) lines.push(`${opt.label}: ${c.label}`);
        }
        if (opt.type === "checkbox" && Array.isArray(v) && v.length){
          const labels = v.map(id => opt.choices.find(c=>c.id===id)?.label).filter(Boolean);
          if (labels.length) lines.push(`${opt.label}: ${labels.join(", ")}`);
        }
      });
      return lines;
    }

    function cartItemCount(){
      let n = 0;
      for (const v of cart.values()) n += v.qty;
      return n;
    }
    function cartTotal(){
      let total = 0;
      for (const entry of cart.values()){
        const item = itemById[entry.itemId];
        const unit = item.price + optionsPriceDelta(item, entry.optionsState);
        total += unit * entry.qty;
      }
      return total;
    }
    function cartEstimatedTime(){
      let maxT = 0;
      for (const entry of cart.values()){
        const item = itemById[entry.itemId];
        const t = item.time + optionsTimeDelta(item, entry.optionsState);
        maxT = Math.max(maxT, t);
      }
      return maxT;
    }

    function changeCartQty(key, delta){
      const e = cart.get(key);
      if (!e) return;
      e.qty += delta;
      if (e.qty <= 0) cart.delete(key);
      renderCart();
    }

    function clearCart(){
      cart.clear();
      renderCart();
    }

    // ====== MENU RENDER ======
    function renderMenu(){
      const menuEl = document.getElementById("menu");
      menuEl.innerHTML = "";
      MENU.forEach(section=>{
        const cat = document.createElement("div");
        cat.className = "category";

        const title = document.createElement("div");
        title.className = "categoryTitle";
        title.innerHTML = `${section.category} <span class="hr"></span> <span>${section.items.length} items</span>`;
        cat.appendChild(title);

        section.items.forEach(item=>{
          const row = document.createElement("div");
          row.className = "item";

          const left = document.createElement("div");
          left.innerHTML = `
            <h3>${item.name}</h3>
            <div class="meta">
              <span class="price">${money(item.price)}</span>
              <span class="time">~ ${item.time} min</span>
              <span>${item.note || ""}</span>
            </div>
          `;

          const right = document.createElement("div");
          const hasOpts = item.options && item.options.length;
          right.innerHTML = `<button class="btn ${hasOpts ? "" : "primary"}">${hasOpts ? "Add (Customize)" : "Add"}</button>`;
          right.querySelector("button").addEventListener("click", ()=>{
            if (hasOpts) openCustomizer(item.id);
            else {
              // add default (no options)
              const key = makeCartKey(item.id, {});
              const ex = cart.get(key);
              if (ex) ex.qty += 1;
              else cart.set(key, { itemId: item.id, qty: 1, optionsState: {} });
              renderCart();
            }
          });

          row.appendChild(left);
          row.appendChild(right);
          cat.appendChild(row);
        });

        menuEl.appendChild(cat);
      });
    }

    // ====== CART RENDER ======
    function renderCart(){
      const list = document.getElementById("cartList");
      const empty = document.getElementById("emptyState");
      list.innerHTML = "";

      const count = cartItemCount();
      document.getElementById("cartCount").textContent = `${count} item${count===1?"":"s"}`;
      document.getElementById("totalPrice").textContent = money(cartTotal());
      document.getElementById("totalTime").textContent = `${cartEstimatedTime()} min`;

      if (cart.size === 0){
        empty.style.display = "block";
        return;
      }
      empty.style.display = "none";

      for (const [key, entry] of cart.entries()){
        const item = itemById[entry.itemId];
        const unit = item.price + optionsPriceDelta(item, entry.optionsState);
        const t = item.time + optionsTimeDelta(item, entry.optionsState);
        const subtotal = unit * entry.qty;
        const lines = optionsToLines(item, entry.optionsState);

        const li = document.createElement("li");
        li.className = "cartItem";

        const left = document.createElement("div");
        left.innerHTML = `
          <div class="name">${item.name}</div>
          <div class="sub">
            <span class="chip">${money(unit)} each</span>
            <span class="chip">~ ${t} min</span>
            <span class="chip">Subtotal: ${money(subtotal)}</span>
          </div>
          ${lines.length ? `<div class="sub">${lines.map(s=>`<span class="chip">${escapeHtml(s)}</span>`).join("")}</div>` : ""}
        `;

        const right = document.createElement("div");
        right.className = "right";
        right.innerHTML = `
          <button class="btn icon danger" aria-label="Decrease">−</button>
          <div class="qty">${entry.qty}</div>
          <button class="btn icon" aria-label="Increase">+</button>
        `;
        right.querySelector("button[aria-label='Decrease']").addEventListener("click", ()=>changeCartQty(key,-1));
        right.querySelector("button[aria-label='Increase']").addEventListener("click", ()=>changeCartQty(key,+1));

        li.appendChild(left);
        li.appendChild(right);
        list.appendChild(li);
      }
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // ====== CUSTOMIZER MODAL ======
    function defaultOptionsFor(item){
      const opts = {};
      (item.options || []).forEach(opt=>{
        if (opt.type === "radio") opts[opt.key] = opt.default ?? (opt.choices?.[0]?.id ?? null);
        if (opt.type === "checkbox") opts[opt.key] = [];
      });
      return opts;
    }

    function openCustomizer(itemId){
      currentItemId = itemId;
      const item = itemById[itemId];
      currentOpts = defaultOptionsFor(item);
      currentQty = 1;

      // header
      document.getElementById("customTitle").textContent = `Customize: ${item.name}`;
      document.getElementById("customSub").innerHTML = `
        <span class="chip">Base: ${money(item.price)}</span>
        <span class="chip">~ ${item.time} min</span>
        <span class="chip">${escapeHtml(item.note || "")}</span>
      `;

      // body options
      renderCustomizerOptions();

      // show
      document.getElementById("customBackdrop").style.display = "flex";
    }

    function closeCustomizer(){
      document.getElementById("customBackdrop").style.display = "none";
      currentItemId = null;
      currentOpts = null;
      currentQty = 1;
    }

    function renderCustomizerOptions(){
      const item = itemById[currentItemId];
      const container = document.getElementById("customOptions");
      container.innerHTML = "";

      (item.options || []).forEach(opt=>{
        const sec = document.createElement("div");
        sec.className = "optSection";

        const head = document.createElement("div");
        head.className = "optHeader";
        head.innerHTML = `
          <div class="title">${opt.label}</div>
          <div class="hint">${opt.type === "radio" ? "choose 1" : "choose any"}</div>
        `;
        sec.appendChild(head);

        const grid = document.createElement("div");
        grid.className = "optGrid";

        opt.choices.forEach(choice=>{
          const id = `c_${currentItemId}_${opt.key}_${choice.id}`;

          const row = document.createElement("div");
          row.className = "optRow";

          const input = document.createElement("input");
          input.id = id;
          input.name = `c_${currentItemId}_${opt.key}`;
          input.type = opt.type;
          input.value = choice.id;

          if (opt.type === "radio"){
            input.checked = currentOpts[opt.key] === choice.id;
            input.addEventListener("change", ()=>{
              currentOpts[opt.key] = choice.id;
              updateCustomizerTotals();
            });
          } else {
            input.checked = (currentOpts[opt.key] || []).includes(choice.id);
            input.addEventListener("change", ()=>{
              const arr = currentOpts[opt.key] || [];
              if (input.checked) arr.push(choice.id);
              else currentOpts[opt.key] = arr.filter(x=>x!==choice.id);
              updateCustomizerTotals();
            });
          }

          const lbl = document.createElement("label");
          lbl.setAttribute("for", id);

          const p = choice.priceDelta ? `+${money(choice.priceDelta)}` : "+$0.00";
          const t = choice.timeDelta ? `+${choice.timeDelta} min` : "+0 min";

          lbl.innerHTML = `
            <div class="optName">${choice.label}</div>
            <div class="optSub">
              <span class="optP">${p}</span>
              <span>${t}</span>
            </div>
          `;

          row.appendChild(input);
          row.appendChild(lbl);
          grid.appendChild(row);
        });

        sec.appendChild(grid);
        container.appendChild(sec);
      });

      updateCustomizerTotals();
      document.getElementById("customQty").textContent = String(currentQty);
    }

    function updateCustomizerTotals(){
      const item = itemById[currentItemId];
      const unit = item.price + optionsPriceDelta(item, currentOpts);
      const t = item.time + optionsTimeDelta(item, currentOpts);
      document.getElementById("customUnitLine").textContent = `${money(unit)} each • ~${t} min`;
    }

    function confirmCustomizer(){
      const item = itemById[currentItemId];
      const key = makeCartKey(currentItemId, currentOpts);
      const existing = cart.get(key);
      if (existing) existing.qty += currentQty;
      else cart.set(key, { itemId: currentItemId, qty: currentQty, optionsState: clone(currentOpts) });

      closeCustomizer();
      renderCart();
    }

    function resetCustomizer(){
      const item = itemById[currentItemId];
      currentOpts = defaultOptionsFor(item);
      currentQty = 1;
      renderCustomizerOptions();
    }

    // ====== SUMMARY MODAL ======
    function buildSummaryText(){
      const lines = [];
      lines.push("ORDER SUMMARY");
      lines.push("—".repeat(44));

      if (cart.size === 0){
        lines.push("No items selected.");
        return lines.join("\n");
      }

      // keep menu order in summary
      const menuOrder = MENU.flatMap(c=>c.items.map(i=>i.id));
      const entries = Array.from(cart.entries()).sort((a,b)=>{
        return menuOrder.indexOf(a[1].itemId) - menuOrder.indexOf(b[1].itemId);
      });

      for (const [key, entry] of entries){
        const item = itemById[entry.itemId];
        const unit = item.price + optionsPriceDelta(item, entry.optionsState);
        const subtotal = unit * entry.qty;
        const opts = optionsToLines(item, entry.optionsState);

        lines.push(`${entry.qty} × ${item.name}  (${money(unit)} ea)  →  ${money(subtotal)}`);
        opts.forEach(s => lines.push(`   - ${s}`));
      }

      lines.push("");
      lines.push(`Total: ${money(cartTotal())}`);
      lines.push(`Estimated prep time: ~${cartEstimatedTime()} min`);
      lines.push("Thank you!");
      return lines.join("\n");
    }

    function openSummary(text){
      document.getElementById("finalList").textContent = text;
      document.getElementById("summaryBackdrop").style.display = "flex";
    }
    function closeSummary(){
      document.getElementById("summaryBackdrop").style.display = "none";
    }

    // ====== EVENTS ======
    document.getElementById("clearBtn").addEventListener("click", clearCart);

    document.getElementById("placeOrderBtn").addEventListener("click", ()=>{
      openSummary(buildSummaryText());
    });

    // customizer buttons
    document.getElementById("customCloseBtn").addEventListener("click", closeCustomizer);
    document.getElementById("customBackdrop").addEventListener("click", (e)=>{
      if (e.target.id === "customBackdrop") closeCustomizer();
    });
    document.getElementById("customConfirmBtn").addEventListener("click", confirmCustomizer);
    document.getElementById("customResetBtn").addEventListener("click", resetCustomizer);

    document.getElementById("customMinus").addEventListener("click", ()=>{
      currentQty = Math.max(1, currentQty - 1);
      document.getElementById("customQty").textContent = String(currentQty);
    });
    document.getElementById("customPlus").addEventListener("click", ()=>{
      currentQty = currentQty + 1;
      document.getElementById("customQty").textContent = String(currentQty);
    });

    // summary modal
    document.getElementById("summaryCloseBtn").addEventListener("click", closeSummary);
    document.getElementById("summaryBackdrop").addEventListener("click", (e)=>{
      if (e.target.id === "summaryBackdrop") closeSummary();
    });

    document.getElementById("copyBtn").addEventListener("click", async ()=>{
      const text = document.getElementById("finalList").textContent;
      try{
        await navigator.clipboard.writeText(text);
        alert("Copied to clipboard.");
      }catch{
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        alert("Copied to clipboard.");
      }
    });

    document.getElementById("newOrderBtn").addEventListener("click", ()=>{
      closeSummary();
      clearCart();
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    // ====== INIT ======
    renderMenu();
    renderCart();
  </script>
</body>
</html>
